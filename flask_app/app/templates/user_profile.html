




{% extends "base.html" %}
{% block title %}My Profile{% endblock %}

{% block content %}
<h2>My Profile</h2>

<div class="card shadow-sm mb-4">
  <div class="card-body">
    <table class="table table-bordered">
      <tr><th>Username</th><td>{{ user.username }}</td></tr>
      <tr><th>Email</th><td>{{ user.email }}</td></tr>
      <tr><th>Address</th><td>{{ user.address or "-" }}</td></tr>
      <tr><th>Mobile Number</th><td>{{ user.number or "-" }}</td></tr>
      <tr><th>Comment</th><td>{{ user.comment or "-" }}</td></tr>

      <tr>
        <th>Categories</th>
        <td>
          {% if user.category_names %}
            {% for c in user.category_names.split(",") %}
              <span class="badge bg-secondary">{{ c.strip() }}</span>
            {% endfor %}
          {% else %} -
          {% endif %}
        </td>
      </tr>

      <tr>
        <th>Brands</th>
        <td>
          {% if user.brand_names %}
            {% for b in user.brand_names.split(",") %}
              <span class="badge bg-info">{{ b.strip() }}</span>
            {% endfor %}
          {% else %} -
          {% endif %}
        </td>
      </tr>

      <tr>
        <th>Assigned Date Range</th>
        <td>
          {% if user.assigned_date_range_start and user.assigned_date_range_end %}
            {{ user.assigned_date_range_start }} → {{ user.assigned_date_range_end }}
          {% else %} -
          {% endif %}
        </td>
      </tr>

      <tr><th>Subscription Date</th><td>{{ user.subscription_date or "-" }}</td></tr>
      <tr><th>Verified</th><td>{{ "Yes" if user.is_verified else "No" }}</td></tr>
    </table>
  </div>
</div>
<h2>My History Update Status</h2>

<div class="card shadow-sm">
  <div class="card-body">

    {% if history %}
    <table class="table table-striped table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Changed At</th>
          <th>Amount</th>
          <th>Payment Status</th>
          <th>Subscription Plan</th>
          <th>Subscription Date</th>
        </tr>
      </thead>

      <tbody>
        {% for h in history %}
        <tr>
          <td>{{ loop.index + ((pagination.page - 1) * 5) }}</td>

          <td>{{ h.changed_at.strftime("%d %b %Y, %H:%M") }}</td>

          <!-- Amount -->
          <td>
            {% if h.snapshot.amount %}
              ₹ {{ "{:,.0f}".format(h.snapshot.amount) }}
            {% else %}
              -
            {% endif %}
          </td>

          <!-- Payment Status -->
          <td>
            {% if h.snapshot.payment_status %}
              {% if h.snapshot.payment_status == "paid" %}
                <span class="badge bg-success">Paid</span>
              {% else %}
                <span class="badge bg-danger">Unpaid</span>
              {% endif %}
            {% else %}
              -
            {% endif %}
          </td>

          <!-- Subscription Plan -->
          <td>
            {{ h.snapshot.subscription_plan or "-" }}
          </td>

          <!-- Subscription Date -->
          <td>
            {{ h.snapshot.subscription_date or "-" }}
          </td>

        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- PAGINATION (UNCHANGED) -->
    <nav>
      <ul class="pagination justify-content-center">

        {% if pagination.has_prev %}
        <li class="page-item">
          <a class="page-link" href="?page={{ pagination.prev_num }}">Previous</a>
        </li>
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">Previous</span>
        </li>
        {% endif %}

        {% for p in range(1, pagination.pages + 1) %}
        <li class="page-item {{ 'active' if p == pagination.page }}">
          <a class="page-link" href="?page={{ p }}">{{ p }}</a>
        </li>
        {% endfor %}

        {% if pagination.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ pagination.next_num }}">Next</a>
        </li>
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">Next</span>
        </li>
        {% endif %}

      </ul>
    </nav>

    {% else %}
      <p class="text-muted">No history available.</p>
    {% endif %}

  </div>
</div>


{% endblock %}
